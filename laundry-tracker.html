<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´—è¡£è®°å½•å°åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s;
        }

        body.dark {
            background: #1a1a1a;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-width: 520px;
            width: 100%;
            padding: 30px 24px 24px;
            transition: all 0.3s;
            position: relative;
        }

        body.dark .container {
            background: #2d2d2d;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .theme-toggle {
            position: absolute;
            top: 18px;
            right: 18px;
            background: #f0f0f0;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        body.dark .theme-toggle {
            background: #3d3d3d;
        }

        .theme-toggle:hover {
            transform: scale(1.08);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 8px;
            font-size: 26px;
            margin-top: 10px;
            transition: color 0.3s;
        }

        body.dark h1 {
            color: #ecf0f1;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 18px;
            transition: color 0.3s;
        }

        body.dark .subtitle {
            color: #999;
        }

        .settings {
            background: #f8f9fa;
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        body.dark .settings {
            background: #252525;
        }

        .settings-row {
            margin-bottom: 12px;
        }

        .settings label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        body.dark .settings label {
            color: #eee;
        }

        .settings input[type="number"] {
            width: 120px;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s, background 0.3s, color 0.3s;
        }

        body.dark .settings input[type="number"] {
            background: #333;
            border-color: #555;
            color: #f5f5f5;
        }

        .settings input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .type-group {
            font-size: 13px;
            color: #444;
        }

        body.dark .type-group {
            color: #ddd;
        }

        .type-group-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px 12px;
            margin-top: 4px;
        }

        .type-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
        }

        .type-pill input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }

        .type-other-input {
            margin-top: 6px;
            width: 100%;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        body.dark .type-other-input {
            background: #333;
            border-color: #555;
            color: #f5f5f5;
        }

        .status-card {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 16px 18px;
            border-radius: 15px;
            margin-bottom: 12px;
            text-align: center;
            overflow: hidden;
        }

        .status-banner {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 6px 10px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        .status-banner-danger {
            background: #ff4b5c;
        }

        .status-banner-warn {
            background: #ffb84d;
            color: #40210a;
        }

        .status-card h2 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
            margin-top: 6px;
        }

        .status-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .status-info p {
            margin: 4px 0;
        }

        .days-left {
            font-size: 20px;
            font-weight: 700;
            margin: 8px 0 4px;
        }

        .status-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.3);
        }

        .status-tag.urgent {
            background: #ff6b6b;
        }

        .status-tag.soon {
            background: #ffd93d;
            color: #333;
        }

        .status-tag.ok {
            background: #51cf66;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        body.dark .btn-secondary {
            background: #333;
            color: #eee;
            border-color: #555;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        body.dark .btn-secondary:hover {
            background: #3a3a3a;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .stats {
            margin-top: 10px;
            margin-bottom: 4px;
            font-size: 13px;
            color: #555;
        }

        body.dark .stats {
            color: #ccc;
        }

        .stats h3 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .stats p {
            margin: 2px 0;
        }

        .type-stats {
            margin-top: 4px;
            font-size: 12px;
        }

        .history {
            margin-top: 12px;
        }

        .history h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }

        body.dark .history h3 {
            color: #eee;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 8px;
        }

        body.dark .history-list {
            background: #252525;
        }

        .history-item {
            background: white;
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 6px;
            font-size: 13px;
            border: 1px solid #eee;
        }

        body.dark .history-item {
            background: #333;
            border-color: #444;
            color: #eee;
        }

        .history-item span.date {
            font-weight: 600;
        }

        .history-item span.types {
            display: block;
            margin-top: 3px;
            font-size: 12px;
            opacity: 0.85;
        }

        .history-item.today {
            border-color: #4caf50;
            box-shadow: 0 0 0 1px rgba(76, 175, 80, 0.4);
        }

        .history-item.today::before {
            content: "ä»Šå¤© Â· ";
            color: #4caf50;
            font-weight: 700;
            margin-right: 2px;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 14px 6px;
            font-size: 13px;
        }

        body.dark .empty-state {
            color: #888;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px 14px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateX(80px);
            transition: all 0.25s;
            z-index: 1000;
            font-size: 13px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px 16px 18px;
            }

            h1 {
                font-size: 22px;
            }

            .theme-toggle {
                top: 12px;
                right: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
        <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>

        <h1>ğŸ§º æ´—è¡£è®°å½•å°åŠ©æ‰‹</h1>
        <p class="subtitle">è®©æ´—è¡£æœå˜å¾—æ›´æœ‰è®¡åˆ’ï¼Œä¸æ€•å¿˜è®°</p>

        <div class="settings">
            <div class="settings-row">
                <label for="interval">æ´—è¡£é—´éš”å¤©æ•°ï¼š</label>
                <input type="number" id="interval" value="3" min="1" max="30">
            </div>
            <div class="settings-row type-group">
                <label>è¿™æ¬¡æ´—äº†ä»€ä¹ˆï¼ˆå¯å¤šé€‰ï¼‰ï¼š</label>
                <div class="type-group-row">
                    <label class="type-pill"><input type="checkbox" name="laundryType" value="è¡£æœ"> è¡£æœ</label>
                    <label class="type-pill"><input type="checkbox" name="laundryType" value="åºŠå•è¢«å¥—"> åºŠå•è¢«å¥—</label>
                    <label class="type-pill"><input type="checkbox" name="laundryType" value="æ¯›å·¾"> æ¯›å·¾</label>
                    <label class="type-pill"><input type="checkbox" name="laundryType" value="è¿åŠ¨æœ"> è¿åŠ¨æœ</label>
                </div>
                <input id="typeOther" class="type-other-input" placeholder="å…¶ä»–ï¼ˆå¯é€‰ï¼Œä¾‹å¦‚ï¼šçª—å¸˜ã€åœ°å«ç­‰ï¼‰">
            </div>
        </div>

        <div class="status-card" id="statusCard">
            <!-- çº¢/æ©™æé†’æ¡ä¼šç”± JS åŠ¨æ€æ’å…¥ -->
            <h2>å½“å‰çŠ¶æ€</h2>
            <div id="statusContent">
                <div class="empty-state">è¿˜æ²¡æœ‰æ´—è¡£è®°å½•ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°å½•å§ï¼</div>
            </div>
        </div>

        <div class="stats" id="stats"></div>

        <button class="btn btn-primary" onclick="addLaundryRecord()">âœ¨ ä»Šå¤©æ´—è¡£æœäº†</button>
        <button class="btn btn-secondary" onclick="copyReminder()">ğŸ“‹ å¤åˆ¶æé†’æ–‡å­—</button>
        <button class="btn btn-secondary" onclick="generateICS()">ğŸ“… ç”Ÿæˆæ—¥å†æé†’</button>
        <button class="btn btn-danger" onclick="clearAllRecords()">ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰è®°å½•</button>

        <div class="history">
            <h3>ğŸ“ å†å²è®°å½•</h3>
            <div class="history-list" id="historyList">
                <div class="empty-state">æš‚æ— å†å²è®°å½•</div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const STORAGE_KEY = 'laundryRecords';
        const INTERVAL_KEY = 'laundryInterval';
        const THEME_KEY = 'laundryTheme';
        const TITLE_DEFAULT = 'æ´—è¡£è®°å½•å°åŠ©æ‰‹';
        let overdueAlertShown = false;

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        function getRecords() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        function saveRecords(records) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        }

        function getInterval() {
            const saved = localStorage.getItem(INTERVAL_KEY);
            return saved ? parseInt(saved) : 3;
        }

        function saveInterval(days) {
            localStorage.setItem(INTERVAL_KEY, days.toString());
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getTodayStr() {
            return formatDate(new Date());
        }

        function getRecordTypes(record) {
            if (record.types && Array.isArray(record.types) && record.types.length > 0) {
                return record.types;
            }
            // å…¼å®¹æ—§æ•°æ®ï¼Œé»˜è®¤å½“æˆâ€œè¡£æœâ€
            return ['è¡£æœ'];
        }

        function getSelectedTypes() {
            const cbs = document.querySelectorAll('input[name="laundryType"]:checked');
            const types = Array.from(cbs).map(cb => cb.value);
            const other = document.getElementById('typeOther').value.trim();
            if (other) {
                types.push('å…¶ä»–ï¼š' + other);
            }
            if (types.length === 0) {
                types.push('è¡£æœ'); // é»˜è®¤
            }
            return types;
        }

        function clearTypeSelection() {
            document.querySelectorAll('input[name="laundryType"]').forEach(cb => cb.checked = false);
            document.getElementById('typeOther').value = '';
        }

        function addLaundryRecord() {
            const records = getRecords();
            const today = getTodayStr();
            const types = getSelectedTypes();

            if (records.length > 0 && records[0].date === today) {
                const override = confirm('ä»Šå¤©å·²ç»è®°å½•è¿‡æ´—è¡£äº†ï¼Œæ˜¯è¦è¦†ç›–è¿˜æ˜¯ä¿æŒåŸè®°å½•ï¼Ÿ\n\nâ€œç¡®å®šâ€ = è¦†ç›–ä»Šå¤©çš„è®°å½•\nâ€œå–æ¶ˆâ€ = ä¿æŒåŸè®°å½•');
                if (!override) {
                    showToast('âœ… å·²ä¿æŒåŸè®°å½•');
                    return;
                } else {
                    records[0] = { date: today, types };
                    saveRecords(records);
                    updateUI();
                    clearTypeSelection();
                    showToast('âœ… å·²è¦†ç›–ä»Šå¤©çš„è®°å½•');
                    return;
                }
            }

            records.unshift({ date: today, types });
            saveRecords(records);
            updateUI();
            clearTypeSelection();
            showToast('âœ… è®°å½•æˆåŠŸï¼');
        }

        function calculateDaysLeft(lastDate, interval) {
            const last = new Date(lastDate);
            const next = new Date(last);
            next.setDate(next.getDate() + interval);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            next.setHours(0, 0, 0, 0);
            return Math.ceil((next - today) / (1000 * 60 * 60 * 24));
        }

        function getStatusInfo(daysLeft) {
            if (daysLeft < 0) {
                return { text: 'å·²è¶…æœŸ', class: 'urgent' };
            } else if (daysLeft === 0) {
                return { text: 'ä»Šå¤©è¯¥æ´—äº†', class: 'urgent' };
            } else if (daysLeft === 1) {
                return { text: 'æ˜å¤©å°±è¯¥æ´—è¡£æœå•¦ï¼Œæå‰å‡†å¤‡ä¸€ä¸‹ï½', class: 'soon' };
            } else if (daysLeft <= 2) {
                return { text: 'å¿«åˆ°æ—¶é—´äº†', class: 'soon' };
            } else {
                return { text: 'æ—¶é—´å……è£•', class: 'ok' };
            }
        }

        function updateStats(records) {
            const statsDiv = document.getElementById('stats');
            if (records.length === 0) {
                statsDiv.innerHTML = '';
                return;
            }

            // è®¡ç®—é—´éš”
            const intervals = [];
            for (let i = 0; i < records.length - 1; i++) {
                const d1 = new Date(records[i].date);
                const d2 = new Date(records[i + 1].date);
                const diff = Math.round((d1 - d2) / (1000 * 60 * 60 * 24));
                if (diff > 0) intervals.push(diff);
            }

            let intervalHtml = '';
            if (intervals.length >= 1) {
                const total = intervals.reduce((a, b) => a + b, 0);
                const avg = Math.round((total / intervals.length) * 10) / 10;
                const min = Math.min(...intervals);
                const max = Math.max(...intervals);

                intervalHtml = `
                    <p>ğŸ“Š æœ€è¿‘ ${intervals.length} æ¬¡æ´—è¡£å¹³å‡é—´éš”ï¼š<strong>${avg}</strong> å¤©ï¼ˆæœ€çŸ­ <strong>${min}</strong> å¤© / æœ€é•¿ <strong>${max}</strong> å¤©ï¼‰</p>
                    <p>ğŸ‘‰ æ ¹æ®ä½ çš„ä¹ æƒ¯ï¼Œå»ºè®®æŠŠé—´éš”è®¾ç½®ä¸º <strong>${Math.round(avg)}</strong> å¤©å·¦å³ã€‚</p>
                `;
            } else {
                intervalHtml = `<p>ğŸ“Š è®°å½•æ¬¡æ•°è¿˜ä¸å¤Ÿå¤šï¼Œæš‚æ—¶æ— æ³•ç»Ÿè®¡å¹³å‡é—´éš”ï½</p>`;
            }

            // æŒ‰ç±»å‹æœ€è¿‘ä¸€æ¬¡
            function findLastByType(typeLabel) {
                for (const rec of records) {
                    const types = getRecordTypes(rec);
                    if (types.some(t => t.includes(typeLabel))) {
                        return rec.date;
                    }
                }
                return 'æš‚æ— è®°å½•';
            }

            const lastSheet = findLastByType('åºŠå•è¢«å¥—');
            const lastTowel = findLastByType('æ¯›å·¾');

            statsDiv.innerHTML = `
                <h3>ğŸ“ˆ ä¹ æƒ¯ç»Ÿè®¡</h3>
                ${intervalHtml}
                <div class="type-stats">
                    <p>ğŸ›ï¸ æœ€è¿‘ä¸€æ¬¡æ´—åºŠå•è¢«å¥—ï¼š<strong>${lastSheet}</strong></p>
                    <p>ğŸ§» æœ€è¿‘ä¸€æ¬¡æ´—æ¯›å·¾ï¼š<strong>${lastTowel}</strong></p>
                </div>
            `;
        }

        function updateUI() {
            const records = getRecords();
            const interval = getInterval();
            const statusContent = document.getElementById('statusContent');
            const historyList = document.getElementById('historyList');
            const statusCard = document.getElementById('statusCard');
            const todayStr = getTodayStr();

            // é»˜è®¤æ ‡é¢˜
            document.title = TITLE_DEFAULT;
            // æ¸…é™¤æ—§ banner
            const oldBanner = statusCard.querySelector('.status-banner');
            if (oldBanner) oldBanner.remove();

            if (records.length === 0) {
                statusContent.innerHTML = '<div class="empty-state">è¿˜æ²¡æœ‰æ´—è¡£è®°å½•ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°å½•å§ï¼</div>';
                historyList.innerHTML = '<div class="empty-state">æš‚æ— å†å²è®°å½•</div>';
                updateStats(records);
                return;
            }

            const lastRecord = records[0];
            const lastDate = new Date(lastRecord.date);
            const nextDate = new Date(lastDate);
            nextDate.setDate(nextDate.getDate() + interval);
            const daysLeft = calculateDaysLeft(lastRecord.date, interval);
            const status = getStatusInfo(daysLeft);

            // å¼ºåŒ–æé†’ï¼šåˆ°æœŸ or æ˜å¤©
            if (daysLeft <= 0) {
                const banner = document.createElement('div');
                banner.className = 'status-banner status-banner-danger';
                banner.textContent = 'å·²ç»åˆ°æ—¶é—´å•¦ï¼ğŸ§º';
                statusCard.prepend(banner);
                document.title = 'ğŸ§º è¯¥æ´—è¡£æœå•¦ï¼';
                if (!overdueAlertShown) {
                    alert('ä»Šå¤©è®°å¾—æ´—è¡£æœï¼ğŸ§º');
                    overdueAlertShown = true;
                }
            } else if (daysLeft === 1) {
                const banner = document.createElement('div');
                banner.className = 'status-banner status-banner-warn';
                banner.textContent = 'æ˜å¤©å°±è¯¥æ´—è¡£æœå•¦ï¼Œæå‰å‡†å¤‡ä¸€ä¸‹ï½';
                statusCard.prepend(banner);
                document.title = TITLE_DEFAULT;
                overdueAlertShown = false;
            } else {
                document.title = TITLE_DEFAULT;
                overdueAlertShown = false;
            }

            // å¤§å­—æç¤ºï¼šè¿˜å‰© / å·²ç»æ™šäº†
            let bigText = '';
            if (daysLeft > 0) {
                bigText = `è¿˜å‰© ${daysLeft} å¤©`;
            } else if (daysLeft === 0) {
                bigText = 'å°±æ˜¯ä»Šå¤©ï¼';
            } else {
                bigText = `å·²ç»æ™šäº† ${Math.abs(daysLeft)} å¤©`;
            }

            statusContent.innerHTML = `
                <div class="status-info">
                    <p>ğŸ“… ä¸Šæ¬¡æ´—è¡£ï¼š${lastRecord.date}</p>
                    <p>ğŸ”œ ä¸‹æ¬¡å»ºè®®ï¼š${formatDate(nextDate)}</p>
                </div>
                <div class="days-left">${bigText}</div>
                <span class="status-tag ${status.class}">${status.text}</span>
            `;

            // å†å²åˆ—è¡¨ + ä»Šå¤©é«˜äº® + ç±»å‹
            historyList.innerHTML = records.map(rec => {
                const types = getRecordTypes(rec).join('ã€');
                const isToday = rec.date === todayStr;
                return `
                    <div class="history-item ${isToday ? 'today' : ''}">
                        <span class="date">${rec.date}</span>
                        <span class="types">æ´—ï¼š${types}</span>
                    </div>
                `;
            }).join('');

            updateStats(records);
        }

        function copyReminder() {
            const records = getRecords();
            if (records.length === 0) {
                showToast('âŒ è¿˜æ²¡æœ‰è®°å½•å¯ä»¥å¤åˆ¶');
                return;
            }

            const interval = getInterval();
            const lastRecord = records[0];
            const nextDate = new Date(lastRecord.date);
            nextDate.setDate(nextDate.getDate() + interval);
            const daysLeft = calculateDaysLeft(lastRecord.date, interval);

            const text = `ğŸ§º æ´—è¡£æé†’
ä¸Šæ¬¡æ´—è¡£ï¼š${lastRecord.date}
ä¸‹æ¬¡å»ºè®®ï¼š${formatDate(nextDate)}
å‰©ä½™å¤©æ•°ï¼š${daysLeft > 0 ? daysLeft : 'å·²è¶…æœŸ'} å¤©`;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('ğŸ“‹ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(() => {
                    showToast('âŒ å¤åˆ¶å¤±è´¥');
                });
            } else {
                showToast('âŒ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè‡ªåŠ¨å¤åˆ¶');
            }
        }

        function generateICS() {
            const records = getRecords();
            if (records.length === 0) {
                showToast('âŒ è¿˜æ²¡æœ‰è®°å½•å¯ä»¥ç”Ÿæˆ');
                return;
            }

            const interval = getInterval();
            const lastRecord = records[0];
            const nextDate = new Date(lastRecord.date);
            nextDate.setDate(nextDate.getDate() + interval);

            const icsDate = formatDate(nextDate).replace(/-/g, '');
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//æ´—è¡£è®°å½•å°åŠ©æ‰‹//CN
BEGIN:VEVENT
UID:${Date.now()}@laundry-tracker
DTSTAMP:${icsDate}T090000Z
DTSTART:${icsDate}T090000Z
DTEND:${icsDate}T093000Z
SUMMARY:ğŸ§º è¯¥æ´—è¡£æœå•¦ï¼
DESCRIPTION:è·ç¦»ä¸Šæ¬¡æ´—è¡£å·²ç»è¿‡å» ${interval} å¤©äº†ï¼Œè®°å¾—ä»Šå¤©æ´—è¡£æœå“¦ï½
BEGIN:VALARM
TRIGGER:-PT1H
ACTION:DISPLAY
DESCRIPTION:ä¸€å°æ—¶åè¯¥æ´—è¡£æœäº†ï¼
END:VALARM
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ´—è¡£æé†’_${formatDate(nextDate)}.ics`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('ğŸ“… æ—¥å†æ–‡ä»¶å·²ä¸‹è½½');
        }

        function clearAllRecords() {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(STORAGE_KEY);
                updateUI();
                showToast('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰è®°å½•');
            }
        }

        // ä¸»é¢˜ç›¸å…³
        const themeToggle = document.getElementById('themeToggle');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark');
                themeToggle.textContent = 'â˜€ï¸'; // æ·±è‰² -> æ˜¾ç¤ºå¤ªé˜³
            } else {
                document.body.classList.remove('dark');
                themeToggle.textContent = 'ğŸŒ™'; // æµ…è‰² -> æ˜¾ç¤ºæœˆäº®
            }
        }

        const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
        applyTheme(savedTheme);

        themeToggle.addEventListener('click', () => {
            const current = document.body.classList.contains('dark') ? 'dark' : 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
            localStorage.setItem(THEME_KEY, next);
        });

        // é—´éš”è¾“å…¥ç›‘å¬ + åˆå§‹å€¼
        document.getElementById('interval').addEventListener('change', (e) => {
            const value = parseInt(e.target.value);
            if (value > 0 && value <= 30) {
                saveInterval(value);
                updateUI();
                showToast('âš™ï¸ é—´éš”å¤©æ•°å·²æ›´æ–°');
            } else {
                showToast('âŒ é—´éš”å¤©æ•°éœ€åœ¨ 1â€“30 ä¹‹é—´');
                document.getElementById('interval').value = getInterval();
            }
        });

        document.getElementById('interval').value = getInterval();
        updateUI();
    </script>
</body>
</html>
